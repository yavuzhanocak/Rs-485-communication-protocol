#include <16f877.h> 
#include <crc.c>
#fuses XT,NOWDT,NOPROTECT,NOBROWNOUT,NOLVP,NOPUT,NOWRT,NODEBUG,NOCPD
#use delay (clock=4000000) 
#use rs232 (baud=9600, xmit=pin_C6, rcv=pin_C7, parity=N, stop=1) // RS232 protokolünün 9600 bit/sn baud hýzýnda olacaðýný ve
#include <kbd.c>                                                                   // TX,RX uçlarýnýn hangi pinler olacaðýný tanýmlýyor
#define enable pin_C4                                                                  // parity bitinin olmadýðýný, stop bitinin 1 bit olacaðý belirtiliyor

char   i,buffer[80];  // klavye isminde 80 üyeli bir dizi tanýmlanýyor
char num=48,k;
int a=4;
#int_RDA 
void seri()
{
   char t1,t2,t3;
   
   t1 = getc();
   if(t1=='1')
   {
      t2=getc();
      t3 = getc();
      if(t2 == 'S')
      {
         output_b(t3);
      }
      else if(t2=='D' && t3 == 'R')
      {
        buffer[0]=num;
         crc=generate_8bit_crc(buffer,2,0x55);
            delay_ms(10);
            output_high(enable);
            delay_ms(1);
            putc('M');
            putc('1');
            putc(buffer[0]);
            putc(crc);
            delay_ms(10);
            output_low(enable);
            
         
      }
   }
  
}

void main()
{
   set_tris_d(0xF0);
   output_b(0);
   
   output_low(enable);
   enable_interrupts(GLOBAL);
   enable_interrupts(INT_RDA);
   while(TRUE)
   {
    k = kbd_getc();  
    if(k!=0){
      output_toggle(pin_b2);
      num=k;
      k=0;
    }
   }

}
